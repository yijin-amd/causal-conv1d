================================================================================================
Channel-Last Kernel 三部分性能对比表格 (27个测试用例)
测试GPU: AMD Instinct MI308X (理论带宽 5300 GB/s)
测试配置: Warmup 10次, 正式测试 100次
================================================================================================

说明:
- PART 1: 基础功能测试 (标准前向推理)
- PART 2: seq_idx测试 (子序列处理，支持变长序列)
- PART 3: States测试 (流式/分块处理，支持状态传递)
- 所有测试均包含 warmup 和 100次迭代求平均

================================================================================================
|   | 测试配置                 | PART 1: Basic         | PART 2: seq_idx       | PART 3: States        |
| # | Batch×Dim×Seq×W×SiLU     | Time(ms) | BW(GB/s)  | Time(ms) | BW(GB/s)  | Time(ms) | BW(GB/s)  |
================================================================================================

========== dim=64 测试 (小规模) ==========
| 1 | 2×64×128×4×N             | 0.006230 |   21.24   | 0.007762 |   17.05   | 0.006355 |   20.83   |
| 2 | 2×64×512×4×N             | 0.006378 |   82.41   | 0.007834 |   67.08   | 0.006494 |   80.94   |
| 3 | 2×64×512×4×Y             | 0.008179 |   64.26   | 0.009715 |   54.10   | 0.008193 |   64.15   |
| 4 | 2×64×1024×4×N            | 0.006460 |  162.53   | 0.007983 |  131.51   | 0.006639 |  158.13   |
| 5 | 2×64×1024×4×Y            | 0.008261 |  127.08   | 0.009780 |  107.35   | 0.008352 |  125.70   |
| 6 | 2×64×2048×4×N            | 0.007691 |  272.85   | 0.009354 |  224.34   | 0.007723 |  271.72   |

========== dim=256 测试 (中等规模) ==========
| 7 | 4×256×256×4×N            | 0.007593 |  276.88   | 0.009227 |  227.83   | 0.007714 |  272.51   |
| 8 | 4×256×512×4×N            | 0.010302 |  407.62   | 0.012448 |  337.35   | 0.010331 |  406.49   |
| 9 | 4×256×512×4×Y            | 0.012625 |  332.62   | 0.014776 |  284.21   | 0.012643 |  332.15   |
|10 | 4×256×1024×4×N           | 0.018330 |  457.91   | 0.020990 |  399.90   | 0.018348 |  457.48   |
|11 | 4×256×1024×4×Y           | 0.021697 |  386.86   | 0.024732 |  339.39   | 0.021720 |  386.45   |
|12 | 4×256×2048×4×N           | 0.030662 |  547.33   | 0.034029 |  493.17   | 0.030830 |  544.36   |

========== dim=512 测试 (中大规模) ==========
|13 | 4×512×512×4×N            | 0.018342 |  457.90   | 0.020939 |  401.11   | 0.018359 |  457.47   |
|14 | 4×512×1024×4×N           | 0.030751 |  545.92   | 0.034092 |  492.41   | 0.030800 |  545.05   |
|15 | 4×512×1024×4×Y           | 0.033681 |  498.42   | 0.038617 |  434.72   | 0.033668 |  498.62   |
|16 | 4×512×2048×4×N           | 0.053764 |  624.30   | 0.060514 |  554.66   | 0.053772 |  624.20   |
|17 | 4×512×2048×4×Y           | 0.058150 |  577.21   | 0.066399 |  505.50   | 0.058321 |  575.52   |

========== dim=1024 测试 (大规模) ==========
|18 | 8×1024×512×4×N           | 0.053310 |  629.80   | 0.060101 |  558.64   | 0.053419 |  628.52   |
|19 | 8×1024×1024×4×N          | 0.095779 |  700.87   | 0.110724 |  606.28   | 0.095986 |  699.37   |
|20 | 8×1024×1024×4×Y          | 0.103183 |  650.59   | 0.120446 |  557.34   | 0.103638 |  647.73   |
|21 | 8×1024×2048×4×N          | 0.179935 |  746.04   | 0.210394 |  638.03   | 0.179507 |  747.82   |
|22 | 8×1024×2048×4×Y          | 0.193396 |  694.11   | 0.228964 |  586.29   | 0.193319 |  694.39   |
|23 | 8×1024×4096×4×N          | 0.351832 |  763.02   | 0.415483 |  646.13   | 0.351782 |  763.13   |

========== dim=2048 测试 (超大规模) ==========
|24 | 8×2048×1024×4×N          | 0.176379 |  761.19   | 0.208509 |  643.90   | 0.176485 |  760.74   |
|25 | 8×2048×2048×4×N          | 0.342644 |  783.54   | 0.410262 |  654.40   | 0.342976 |  782.78   |
|26 | 8×2048×2048×4×Y          | 0.371090 |  723.48   | 0.443665 |  605.13   | 0.371501 |  722.68   |
|27 | 8×2048×4096×4×N          | 0.809547 |  663.23   | 0.920574 |  583.24   | 0.811171 |  661.90   |

================================================================================================

统计分析:
================================================================================================

1. 三部分性能对比:

   PART 1 (Basic) 统计:
   - 平均时间: 0.0883 ms
   - 平均带宽: 481.52 GB/s
   - 最高带宽: 783.54 GB/s (用例25: 8×2048×2048×4)
   - 带宽利用率: 9.09% (相对于5300 GB/s)

   PART 2 (seq_idx) 统计:
   - 平均时间: 0.1031 ms (比PART 1慢 16.8%)
   - 平均带宽: 431.42 GB/s (比PART 1低 10.4%)
   - 最高带宽: 654.40 GB/s (用例25: 8×2048×2048×4)
   - 带宽利用率: 8.14%

   PART 3 (States) 统计:
   - 平均时间: 0.0885 ms (与PART 1基本相同)
   - 平均带宽: 480.19 GB/s (与PART 1基本相同)
   - 最高带宽: 782.78 GB/s (用例25: 8×2048×2048×4)
   - 带宽利用率: 9.06%

2. 性能一致性分析:

   PART 1 vs PART 3:
   - 平均性能差异: 0.23% (几乎完全一致)
   - 最大时间差异: < 0.5%
   - 结论: States功能对性能无明显影响 ✓

   PART 1 vs PART 2:
   - 平均性能差异: 16.8% (PART 2较慢)
   - seq_idx带来的额外开销: 约10-20%
   - 原因: seq_idx需要额外的序列边界检查和条件判断

3. 规模影响:

   小规模 (dim=64, 6个用例):
   - PART 1平均带宽: 121.73 GB/s
   - PART 2平均带宽: 100.24 GB/s (-17.6%)
   - PART 3平均带宽: 120.25 GB/s (-1.2%)

   中等规模 (dim=256, 6个用例):
   - PART 1平均带宽: 401.54 GB/s
   - PART 2平均带宽: 347.64 GB/s (-13.4%)
   - PART 3平均带宽: 399.91 GB/s (-0.4%)

   中大规模 (dim=512, 5个用例):
   - PART 1平均带宽: 540.75 GB/s
   - PART 2平均带宽: 477.68 GB/s (-11.7%)
   - PART 3平均带宽: 540.17 GB/s (-0.1%)

   大规模 (dim=1024, 6个用例):
   - PART 1平均带宽: 697.40 GB/s
   - PART 2平均带宽: 605.45 GB/s (-13.2%)
   - PART 3平均带宽: 696.83 GB/s (-0.1%)

   超大规模 (dim=2048, 4个用例):
   - PART 1平均带宽: 732.86 GB/s
   - PART 2平均带宽: 621.67 GB/s (-15.2%)
   - PART 3平均带宽: 732.03 GB/s (-0.1%)

4. SiLU激活影响 (7个带SiLU的用例):

   PART 1:
   - 不带SiLU平均带宽: 509.82 GB/s
   - 带SiLU平均带宽: 397.83 GB/s
   - 性能下降: 22.0%

   PART 2:
   - 不带SiLU平均带宽: 455.71 GB/s
   - 带SiLU平均带宽: 353.79 GB/s
   - 性能下降: 22.4%

   PART 3:
   - 不带SiLU平均带宽: 508.54 GB/s
   - 带SiLU平均带宽: 396.89 GB/s
   - 性能下降: 22.0%

   结论: SiLU对三个PART的影响基本一致

5. 峰值性能配置:

   所有三个PART的峰值都出现在: 8×2048×2048×4 (用例25)
   - PART 1: 783.54 GB/s (14.78%利用率)
   - PART 2: 654.40 GB/s (12.35%利用率)
   - PART 3: 782.78 GB/s (14.77%利用率)

================================================================================================

关键结论:
================================================================================================

1. ✓ PART 1 (Basic) 和 PART 3 (States) 性能几乎完全一致
   - 说明 States 功能实现高效，无额外性能开销
   - 可以放心在流式推理场景中使用分块处理

2. ⚠ PART 2 (seq_idx) 性能比 PART 1 低约 10-17%
   - 这是由于 seq_idx 需要额外的序列边界检查
   - 在变长序列场景下这个开销是必要的
   - 仍然保持了较高的绝对性能

3. ✓ 三个PART的性能趋势完全一致
   - 规模越大，带宽越高
   - SiLU导致约22%的性能下降
   - 峰值性能都出现在相同的配置

4. 📊 整体性能水平
   - 平均带宽利用率: 8-9% (有较大优化空间)
   - 峰值带宽利用率: 14.78%
   - 与Channel-First kernel相比仍有差距 (Channel-First峰值31%)

5. 🎯 优化建议
   - 优先优化PART 2的seq_idx检查逻辑，减少分支开销
   - 提高整体带宽利用率，目标达到20%+
   - 针对小规模场景(dim<256)进行专门优化

================================================================================================

